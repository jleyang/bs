{"version":3,"sources":["webpack:///./src/views/Statistics.vue?b993","webpack:///./src/views/Statistics.vue","webpack:///./src/services/statistics.js","webpack:///src/views/Statistics.vue","webpack:///./src/views/Statistics.vue?14e3","webpack:///./src/views/Statistics.vue?bc6a"],"names":["render","_vm","this","_c","_self","staticClass","ref","on","userSelectChange","staticStyle","attrs","reload","directives","name","rawName","value","swipeHandler","expression","arg","minDate","maxDate","formatter","defaultDate","dayChange","_e","dayLogs","length","_v","_s","dayjs","daka_time","format","daka_result","kaoqin_time","staticRenderFns","getSignReport","data","Promise","resolve","page","request","url","method","then","res","components","UserSelecter","startOf","toDate","endOf","signReport","userInfo","methods","direction","changeMonth","Math","abs","subtract","add","start_time","unix","end_time","$nextTick","day","dayDay","date","all","filter","r","rDay","succ","className","reject","loading","organ_id","username","concat","list","item","index","self","findIndex","t","Date","catch","err","component"],"mappings":"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","file":"js/chunk-8cf922f6.eb4dab29.js","sourcesContent":["export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--9-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Statistics.vue?vue&type=style&index=0&id=3f7df56d&prod&scoped=true&lang=scss&\"","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"index\"},[_c('user-selecter',{ref:\"userSelecter\",on:{\"change\":_vm.userSelectChange}}),_c('van-cell-group',{staticStyle:{\"margin-top\":\"10px\"},attrs:{\"inset\":\"\"}},[(_vm.reload)?_c('van-calendar',{directives:[{name:\"touch\",rawName:\"v-touch:swipe\",value:(_vm.swipeHandler),expression:\"swipeHandler\",arg:\"swipe\"}],staticClass:\"calendar\",attrs:{\"poppable\":false,\"show-title\":false,\"show-confirm\":false,\"min-date\":_vm.minDate,\"max-date\":_vm.maxDate,\"formatter\":_vm.formatter,\"default-date\":_vm.defaultDate,\"color\":\"#1989fa\"},on:{\"select\":_vm.dayChange}}):_vm._e()],1),_c('van-cell-group',{staticStyle:{\"margin-top\":\"10px\",\"margin-bottom\":\"10px\"},attrs:{\"inset\":\"\"}},[(_vm.dayLogs.length > 0)?_c('van-steps',{staticClass:\"timeline\",attrs:{\"direction\":\"vertical\"}},[_c('van-step'),_c('van-step',[_c('h3',[_c('span',[_vm._v(\"上午 \"+_vm._s(_vm.dayjs(_vm.dayLogs[0].daka_time * 1000).format('HH:mm')))]),(_vm.dayLogs[0].daka_result === 2)?_c('van-tag',{attrs:{\"type\":\"warning\"}},[_vm._v(\"迟到\")]):_vm._e(),(_vm.dayLogs[0].daka_result === 5)?_c('van-tag',{attrs:{\"type\":\"danger\"}},[_vm._v(\"缺卡\")]):_vm._e()],1),_c('p',[_vm._v(\"考勤时间: \"+_vm._s(_vm.dayjs(_vm.dayLogs[0].kaoqin_time * 1000).format('HH:mm')))])]),(_vm.dayLogs.length > 2)?_c('van-step',[_c('h3',[_c('span',[_vm._v(\"下午 \"+_vm._s(_vm.dayjs(_vm.dayLogs[2].daka_time * 1000).format('HH:mm')))]),(_vm.dayLogs[2].daka_result === 2)?_c('van-tag',{attrs:{\"type\":\"warning\"}},[_vm._v(\"迟到\")]):_vm._e(),(_vm.dayLogs[2].daka_result === 5)?_c('van-tag',{attrs:{\"type\":\"danger\"}},[_vm._v(\"缺卡\")]):_vm._e()],1),_c('p',[_vm._v(\"考勤时间: \"+_vm._s(_vm.dayjs(_vm.dayLogs[2].kaoqin_time * 1000).format('HH:mm')))])]):_vm._e()],1):_vm._e()],1)],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import request from '@/utils/request'\n\n/**\n * 获取打卡报表\n * @param organ_id\n * @param name\n * @param start_time\n * @param end_time\n *\n */\nexport function getSignReport(data) {\n  return new Promise(resolve => {\n    data.page = 0\n    request({\n      url: 'kqdakatimebaobiao',\n      method: 'POST',\n      data\n    }).then(res => {\n      resolve(res.data)\n    })\n  })\n}\n","<template lang=\"pug\">\n  .index\n    user-selecter(ref=\"userSelecter\" @change=\"userSelectChange\")\n\n    van-cell-group(inset style=\"margin-top: 10px;\"): van-calendar.calendar(\n      v-if=\"reload\"\n      :poppable=\"false\"\n      :show-title=\"false\"\n      :show-confirm=\"false\"\n      :min-date=\"minDate\"\n      :max-date=\"maxDate\"\n      :formatter=\"formatter\"\n      :default-date=\"defaultDate\"\n      color=\"#1989fa\"\n      @select=\"dayChange\"\n      v-touch:swipe=\"swipeHandler\"\n    )\n\n    van-cell-group(inset style=\"margin-top: 10px; margin-bottom: 10px;\"): van-steps.timeline(v-if=\"dayLogs.length > 0\" direction=\"vertical\")\n      van-step\n      van-step\n        h3\n          span 上午 {{ dayjs(dayLogs[0].daka_time * 1000).format('HH:mm') }}\n          van-tag(type=\"warning\" v-if=\"dayLogs[0].daka_result === 2\") 迟到\n          van-tag(type=\"danger\" v-if=\"dayLogs[0].daka_result === 5\") 缺卡\n        p 考勤时间: {{ dayjs(dayLogs[0].kaoqin_time * 1000).format('HH:mm') }}\n      van-step(v-if=\"dayLogs.length > 2\")\n        h3\n          span 下午 {{ dayjs(dayLogs[2].daka_time * 1000).format('HH:mm') }}\n          van-tag(type=\"warning\" v-if=\"dayLogs[2].daka_result === 2\") 迟到\n          van-tag(type=\"danger\" v-if=\"dayLogs[2].daka_result === 5\") 缺卡\n        p 考勤时间: {{ dayjs(dayLogs[2].kaoqin_time * 1000).format('HH:mm') }}\n</template>\n\n<script>\nimport dayjs from 'dayjs'\nimport UserSelecter from '@/components/UserSelecter'\nimport { getSignReport } from '@/services/statistics'\n\nexport default {\n  name: 'Statistics',\n  components: {\n    UserSelecter\n  },\n  data() {\n    return {\n      dayjs,\n      minDate: dayjs().startOf('month').toDate(),\n      maxDate: dayjs().endOf('month').toDate(),\n      signReport: [],\n      dayLogs: [],\n      reload: true,\n      userInfo: {},\n      defaultDate: null\n    }\n  },\n  methods: {\n    swipeHandler(direction) {\n      if (direction === 'left') {\n        this.changeMonth(1)\n      } else if (direction === 'right') {\n        this.changeMonth(-1)\n      }\n    },\n    changeMonth(value) {\n      if (value === 0) return\n      if (value < 0) {\n        value = Math.abs(value)\n        this.minDate = dayjs(this.minDate).subtract(value, 'month').startOf('month').toDate()\n        this.maxDate = dayjs(this.maxDate).subtract(value, 'month').endOf('month').toDate()\n      } else {\n        this.minDate = dayjs(this.minDate).add(value, 'month').startOf('month').toDate()\n        this.maxDate = dayjs(this.maxDate).add(value, 'month').endOf('month').toDate()\n      }\n      this.dayLogs = []\n      this.getSignReport({\n        start_time: dayjs(this.minDate).startOf('month').unix(),\n        end_time: dayjs(this.maxDate).endOf('month').unix()\n      })\n\n      this.reload = false\n      this.$nextTick(() => {\n        this.reload = true\n      })\n    },\n    formatter(day) {\n      const dayDay = dayjs(day.date).format('YYYY-MM-DD')\n      const all = this.signReport.filter(r => {\n        const rDay = dayjs(r.kaoqin_time * 1000).format('YYYY-MM-DD')\n        return rDay === dayDay\n      })\n      const succ = all.filter(r => r.daka_result === 1)\n\n      // 休息日\n      if (all.length === 0) {\n        day.className = 'day-rest'\n        return day\n      }\n\n      // 正常\n      if (succ.length >= 2) {\n        day.className = 'day-succ'\n        return day\n      }\n\n      // 缺卡\n      if (succ.length < 2) {\n        day.className = 'day-miss'\n        return day\n      }\n    },\n    dayChange(date) {\n      const day = dayjs(date).format('YYYY-MM-DD')\n      const dayLogs = this.signReport.filter(r => {\n        const rDay = dayjs(r.kaoqin_time * 1000).format('YYYY-MM-DD')\n        return rDay === day\n      })\n      this.dayLogs = dayLogs\n    },\n    getSignReport({ start_time, end_time }) {\n      return new Promise((resolve, reject) => {\n        this.loading = true\n        getSignReport({\n          organ_id: this.userInfo.organ_id,\n          name: this.userInfo.username,\n          start_time,\n          end_time\n        }).then(res => {\n          this.signReport = this.signReport.concat(res.list)\n          // 过滤掉kaoqin_time相同的\n          this.signReport = this.signReport.filter((item, index, self) => {\n            return self.findIndex(t => t.kaoqin_time === item.kaoqin_time) === index\n          })\n\n          // 选中默认日期\n          if (dayjs(start_time * 1000).format('YYYY-MM') === dayjs().format('YYYY-MM')) {\n            this.defaultDate = new Date()\n          } else {\n            this.defaultDate = dayjs(start_time * 1000).toDate()\n          }\n          this.dayChange(this.defaultDate)\n\n          this.loading = false\n          resolve(res)\n        }).catch(err => {\n          reject(err)\n        })\n      })\n    },\n    userSelectChange(userInfo) {\n      this.userInfo = userInfo\n      this.dayLogs = []\n      this.signReport = []\n      this.getSignReport({\n        start_time: dayjs(this.minDate).unix(),\n        end_time: dayjs(this.maxDate).unix()\n      })\n    }\n  }\n}\n</script>\n\n<style scoped lang=\"scss\">\n  ::v-deep .calendar {\n    // 去掉背景水印\n    .van-calendar__month-mark {\n      display: none;\n    }\n    // 日样式\n    .van-calendar__day {\n      color: #233;\n      font-size: 15px;\n    }\n    // 选中日样式\n    .van-calendar__selected-day {\n      border-radius: 100%;\n      flex-shrink: 0;\n      width: 36px;\n      height: 36px;\n    }\n    .van-calendar__weekday {\n      color: #888;\n    }\n    .day-miss {\n      position: relative;\n      &:before {\n        position: absolute;\n        bottom: 7px;\n        left: calc(50% - 2px);\n        content: ' ';\n        font-size: 12px;\n        border-radius: 100%;\n        width: 4px;\n        height: 4px;\n        background: #ff976a;\n      }\n    }\n    .day-rest {\n      color: #888;\n    }\n  }\n  ::v-deep .van-step:first-child {\n    display: none;\n  }\n  ::v-deep .timeline {\n    .van-step__title {\n      h3 {\n        display: flex;\n        align-items: center;\n        font-size: 15px;\n        font-weight: normal;\n        color: #233;\n        .van-tag {\n          margin-left: 4px;\n        }\n      }\n      p {\n        font-size: 12px;\n        color: #888;\n      }\n    }\n  }\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Statistics.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Statistics.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Statistics.vue?vue&type=template&id=3f7df56d&scoped=true&lang=pug&\"\nimport script from \"./Statistics.vue?vue&type=script&lang=js&\"\nexport * from \"./Statistics.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Statistics.vue?vue&type=style&index=0&id=3f7df56d&prod&scoped=true&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"3f7df56d\",\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}